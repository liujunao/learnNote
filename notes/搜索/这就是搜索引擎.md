# 一、搜索引擎及其技术架构

## 1、搜索引擎技术发展史

- **史前时代(分类目录的一代)**：通过人工收集整理，把属于各个类别的高质量网站或网页分门别类罗列，用户可以根据分级目录来查找高质量的网站

- **第一代(文本检索的一代)**：采用经典的信息检索模型，比如：布尔模型、向量空间模型、概率模型，来计算用户查询关键词和网页文本内容的相关程度

- **第二代(链接分析的一代)**：充分利用了网页之间的链接关系，并深入挖掘和利用了网页链接所代表的含义

    > - Google率先提出并使用PageRank链接分析技术，采用链接分析能够有效改善搜索结果质量
    >
    > - 并未考虑用户的个性化要求，所以只要输入的查询请求相同，所有用户都会获得相同的搜索结果

- **第三代(用户中心的一代)**：理解用户发出的某个很短小的查询词背后包含的真正需求

## 2、搜索引擎的3个目标

- **更全**：从索引的网页数量而言，可以通过提高网络爬虫相关技术来达到此目标
- **更快**：索引相关技术、缓存技术、分布式海量云存储平台等
- **更准**：排序技术、链接分析技术、用户研究技术

<img src="../../pics/search/search_1.png" width=600 align=left>

## 3、搜索引擎的技术架构

<img src="../../pics/search/search_2.png" width=800 align=left>

# 二、网络爬虫

## 1、通用爬虫框架

<img src="../../pics/search/search_3.png" width=800 align=left>

- 首先，从互联网页面中精心选择一部分网页，以这些网页的链接地址作为种子URL，将这些种子 URL 放入待抓取 URL 队列中，爬虫从待抓取 URL 队列依次读取，并将 URL通过DNS解析，把链接地址转换为网站服务器对应的IP地址。

- 然后 将其和网页相对路径名称交给网页下载器，对于下载到本地的网页，一方面将其存储到页面库中，等待建立索引等后续处理;另一方面将下载网页的URL放入已抓取URL队列中， 这个队列记载了爬虫系统已经下载过的网页URL，以避免网页的重复抓取。
- 对于刚下载的网页，从中抽取出所包含的所有链接信息，并在已抓取URL队列中检查，如果发现链接还没有被抓取过，则将这个URL放入待抓取URL队列末尾，在之后的抓取调度中会下载这个URL对应的网页

如此这般，形成循环，直到待抓取URL队列为空，这代表着爬虫系统已将能够抓取的网页尽数抓完，此时完成了一轮完整的抓取过程。

> 对于爬虫来说，往往还需要进行网页去重及网页反作弊

---

**爬虫划分为如下3种类型**：

- 批量型爬虫(**Batch Crawler**)：有比较明确的抓取范围和目标，当爬虫达到这个设定的目标后，即停止抓取过程

- 增量型爬虫(**Incremental Crawler**)：会保持持续不断的抓取，对于抓取到的网页，要定期更新

- 垂直型爬虫(**Focused Crawler**)：关注特定主题内容或属于特定行业的网页

    > - 最大的特点和难点：如何识别网页内容是否属于指定行业或主题
    >
    > - 需要爬虫在抓取阶段就能够动态识别某个网址是否与主题相关，并尽量不去抓取无关页面，以达到节省资源的目的

## 2、优秀爬虫的特性

实用的爬虫系统都应该具备以下几种特性：

- **高性能**：主要是指爬虫下载网页的抓取速度，常见的评价方式是以爬虫每秒能够下载的网页数量作为性能指标

    > 要提高爬虫的性能，在设计时程序访问磁盘的操作方法及具体实现 时数据结构的选择很关键

- **可扩展性**：爬虫需要抓取的网页数量巨大，为了能够尽可能缩短抓取周期，爬虫系统应该有很好的可扩展性，即很容易通过增加抓取服务器和爬虫数量来达到此目的

- **健壮性**：

- **友好性**：









## 3、爬虫质量的评价标准







## 4、抓取策略

### (1) 宽度优先遍历策略(Breath First)







### (2) 非完全 PageRank 策略(Partial PageRank)







### (3) OCIP策略(Online Page Importance Compuation)





### (4) 大站优先策略(Larger Sites First)





## 5、网页更新策略

### (1) 历史参考策略





### (2) 用户体验策略





### (3) 聚类抽样策略







## 6、暗网抓取(Deep Web Crawling)

### (1) 查询组合问题





### (2) 文本框填写问题





## 7、分布式爬虫

### (1) 主从式分布爬虫(Master-Slave)





### (2) 对等式分布爬虫(Peer to Peer)







# 三、搜索引擎索引

## 1、索引基础

### (1) 单词 -- 文本矩阵





### (2) 倒排索引基本概念





### (3) 倒排索引简单实例





## 2、单词词典

### (1) 哈希加链表





### (2) 树形结构





## 3、倒排列表







## 4、建立索引

### (1) 两遍文档遍历法







### (2) 排序法





### (3) 归并法





## 5、动态索引







## 6、索引更新策略

### (1) 完全重建策略







### (2) 再合并策略





### (3) 原地更新策略







### (4) 混合策略







## 7、查询处理

### (1) 一次一文档





### (2) 一次一单词





### (3) 跳跃指针







## 8、多字段索引

### (1) 多索引方式







### (2) 倒排列表方式







### (3) 扩展列表方式





## 9、短语查询

### (1) 位置信息索引







### (2) 双词索引







### (3) 短语索引







### (4) 混合方法







## 10、分布式索引

### (1) 按文档划分





### (2) 按单词划分





### (3) 两种方案的比较





# 四、索引压缩

## 1、词典压缩





## 2、倒排列表压缩算法

### (1) 评价索引压缩算法的指标





### (2) 一元编码与二进制编码







### (3) Elias Gamma 算法与 Elias Delta 算法





### (4) Golomb 算法与 Rice 算法







### (5) 变长字节算法





### (6) SimpleX 系列算法





### (7) PForDelta 算法





## 3、文档编号重排序





## 4、静态索引裁剪

### (1) 以单词为中心的索引裁剪





### (2) 以文档为中心的索引裁剪







# 五、索引模型与搜索排序

## 1、布尔模型







## 2、向量空间模型

### (1) 文档表示





### (2) 相似性计算







### (3) 特征权重计算







## 3、概率检索模型

### (1) 概率排序原理







### (2) 二元独立模型





### (3) BM25 模型





### (4) BM25F模型





## 4、语言模型方法









## 5、机器学习排序

### (1) 机器学习排序的基本思路





### (2) 单文档方法





### (3) 文档对方法







### (4) 文档列表方法







## 6、检索质量评价标准

### (1) 精确率与召回率





### (2) P@10 指标





### (3) MAP 指标





# 六、链接分析

## 1、Web 图







## 2、两个概念模型及算法之间的关系

### (1) 随机游走模型







### (2) 子集传播模型





### (3) 链接分析算法之间的关系





## 3、PageRank 算法

### (1) 从入链数量到 PageRank







### (2) PageRank 计算







### (3) 链接陷阱与远程跳转





## 4、HITS 算法

### (1) Hub 页面与 Authority 页面





### (2) 相互增强关系







### (3) HITS 算法





### (4) HITS 算法存在的问题





### (5) HITS 算法与 PageRank 算法比较







## 5、SALSA 算法

### (1) 确定计算对象集合





### (2) 链接关系传播







### (3) Authority 权值计算







## 6、主题敏感 PageRank

### (1) 主题敏感 PageRank 与 PageRank 的差异







### (2) 主题敏感 PageRank 计算流程







### (3) 利用主题敏感 PageRank 构造个性化搜索







## 7、Hilltop 算法

### (1) Hilltop 算法的基本定义





### (2) Hilltop 算法







## 8、其他改进算法

### (1) 智能游走模型





### (2) 偏置游走模型





### (3) PHITS 算法





### (4) BFS 算法







# 七、云存储与云计算

## 1、云存储与云计算概述

### (1) 基本假设





### (2) 理论基础





### (3) 数据模型





### (4) 基本问题





### (5) Google 的云存储与云计算架构







## 2、Google 文件系统(GFS)

### (1) GFS 设计原则





### (2) GFS 整体架构





### (3) GFS 主控服务器





### (4) 系统交互行为







## 3、Chubby锁服务





## 4、BigTable

### (1) BigTable 的数据模型







### (2) BigTable 整体结构







### (3) BigTable 的管理数据







### (4) 主控服务器(Master Server)







### (5) 子表服务器(Tablet Server)







## 5、Megastore 系统

### (1) 实体群组切分







### (2) 数据模型







### (3) 数据读/写与备份





## 6、Map/Reduce 云计算模型

### (1) 计算模型







### (2) 整体逻辑流程







### (3) 应用示例





## 7、咖啡因系统 -- Percolator

### (1) 事务支持





### (2) 观察/通知体系结构





## 8、Pregel 图计算模型







## 9、Dynamo 云存储系统

### (1) 数据划分算法







### (2) 数据备份







### (3) 数据读/写







### (4) 数据版本控制







## 10、PNUTS 云存储系统

### (1) PNUTS 整体架构







### (2) 存储单元





### (3) 子表控制器与数据路由器







### (4) 雅虎消息代理





### (5) 数据一致性







## 11、HayStack 存储系统

### (1) HayStack 整体架构







### (2) 目录服务







### (3) HayStack 缓存







### (4) HayStack 存储系统









# 八、网页反作弊

## 1、内容作弊

### (1) 常见内容作弊手段





### (2) 内容农场







## 2、链接作弊







## 3、页面隐藏作弊







## 4、Web 2.0 作弊方法







## 5、反作弊技术的整体思路

### (1) 信任传播模型





### (2) 不信任传播模型







### (3) 异常发现模型







## 6、通用链接反作弊方法

### (1) TrustRank 算法







### (2) BadRank 算法







### (3) SpamRank







## 7、专用链接反作弊技术

### (1) 识别链接农场







### (2) 识别 Google 轰炸







## 8、识别内容作弊







## 9、反隐藏作弊

### (1) 识别页面隐藏





### (2) 识别网页重定向







## 10、搜索引擎反作弊综合框架







# 九、用户查询意图分析

## 1、搜索行为及其意图

### (1) 用户搜索行文







### (2) 用户搜索意图分类





## 2、搜索日志挖掘

### (1) 查询会话





### (2) 点击图





### (3) 查询图







## 3、相关搜索

### (1) 基于查询会话的方法







### (2) 基于点击图的方法







## 4、查询纠错

### (1) 编辑距离







### (2) 噪声信道模型





# 十、网页去重

## 1、通用去重算法框架







## 2、Shingling 算法





## 3、I-Match 算法







## 4、SimHash 算法

### (1) 文档指纹计算







### (2) 相似文档查找







## 5、SpotSig 算法

### (1) 特征抽取





### (2) 相似文档查找







# 十一、搜索引擎缓存机制

## 1、搜索引擎缓存系统架构







## 2、缓存对象







## 3、缓存结构





## 4、缓存淘汰策略

### (1) 动态策略







### (2) 混合策略







## 5、缓存更新策略







# 十二、搜索引擎发展趋势

### (1) 个性化搜索







### (2) 社会化搜索







### (3) 实时搜索





### (4) 移动搜索





### (5) 地理位置感知搜索





### (6) 跨语言搜索







### (7) 多媒体搜索







### (8) 情境搜索




