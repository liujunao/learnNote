# 一、prompt

Prompt 即服务编排

- **编排模式**
    - 简易模式编排
    - Assistant 模式编排
    - Flow 模式编排

- **Prompt 变量类型**
    - 字符串
    - 单选枚举
    - 外部 API
    - 文件（Q3 即将推出）

# 二、model

- 多模态（ASR模型、GPT-4o）
- 模型：推理模型、embedding 模型、rerank 模型、文字转语音模型、语音转文字模型
- 负载均衡(Rate Limits)：通过在多个 API 端点之间分配 API 请求，确保所有用户都能获得最快的响应和最高的模型调用吞吐量，保障业务稳定运行

---

速率限制以两种方式测量：**RPM**（每分钟请求数）和**TPM**（每分钟标记数）

- RPM：代表每分钟处理的请求数量，每个请求可以是一个独立的操作

- TPM：代表每分钟处理的标记（tokens）数量

区别：

- RPM 衡量的是请求数量，即多少次调用或操作
- TPM 衡量的是标记数量，即处理的文本基本单位的数量

---

控制请求速率的方式：

- **令牌桶算法**：使用一个桶存放令牌，令牌以固定速率添加到桶中。每个请求需要一个令牌，如果桶中没有令牌，则请求被拒绝或延迟处理
- **漏桶算法**：请求被放入一个固定容量的桶中，以固定速率处理请求。桶满时，新请求被拒绝或排队

- **固定窗口计数法**：在固定时间窗口内计数请求数量，超过限制时拒绝请求。时间窗口结束时，计数重置
- **后端请求队列**：请求进入队列，后端服务按固定速率从队列中取出请求进行处理

---

避免速率限制错误的一种简单方法是使用随机指数退避自动重试请求。

- 使用指数回退重试意味着当达到速率限制错误时执行短暂休眠，然后重试不成功的请求
- 如果请求仍然不成功，则增加休眠长度并重复该过程
- 这将持续到请求成功或达到最大重试次数

---

为了在高流量场景中配置多个账号以调用 ChatGPT，你可以考虑以下几种方案：

1. **轮询法**：轮流使用多个 API 密钥，以避免单个密钥的速率限制。
2. **负载均衡**：使用负载均衡器，将请求分配到不同的服务器，每个服务器使用不同的 API 密钥。
3. **队列管理**：使用队列系统来管理请求，确保请求按序处理，同时使用多个 API 密钥进行处理



# 三、tool

工具：OpenAPI / Swagger 和 OpenAI Plugin 规范

- https://swagger.io/specification/

按返回值分类：

- 图片 URL
- 链接
- 文本
- 文件 BLOB
- JSON



# 四、agent

Agent 技术：ReAct，Function Call



# 五、RAG

RAG 特性

- **索引方式**
    - 关键词
    - 文本向量
    - 由 LLM 辅助的问题-分段模式

- **检索方式**
    - 关键词
    - 文本相似度匹配
    - 混合检索
    - N 选 1 模式（即将下线）
    - 多路召回

- **召回优化技术**

    - 使用 ReRank 模型

- 具体的

    - 分段与清洗
    - 对多源数据进行预处理和清洗，即 ETL （*extract, transform, load*）：[**Unstructured ETL** ](https://unstructured.io/) 

    - 索引方式：
        - **高质量模式：**将调用 OpenAI 的嵌入接口进行处理，以在用户查询时提供更高的准确度。
        - **经济模式**：会使用关键词索引方式，降低了准确度但无需花费 Token。
        - **Q&A 模式（仅社区版支持）：**Q&A 分段模式功能，与上述普通的「Q to P」（问题匹配文本段落）匹配模式不同，它是采用「Q to Q」（问题匹配问题）匹配工作，在文档经过分段后，经过总结为每一个分段生成 Q&A 匹配对，当用户提问时，系统会找出与之最相似的问题，然后返回对应的分段作为答案。这种方式更加精确，因为它直接针对用户问题进行匹配，可以更准确地获取用户真正需要的信息

    - 检索方式：
        - **向量检索**，通过生成查询嵌入并查询与其向量表示最相似的文本分段。
        - **全文检索**，索引文档中的所有词汇，从而允许用户查询任意词汇，并返回包含这些词汇的文本片段。
        - **混合检索**，同时执行全文检索和向量检索，并附加重排序步骤，从两类查询结果中选择匹配用户问题的最佳结果，需配置 Rerank 模型 API。



# 六、Workflow

Agentic Workflow 特性：

- LLM
- 知识库检索
- 问题分类
- 条件分支
- 代码执行
- 模板转换
- HTTP 请求
- 工具



Dify 工作流分为两种类型：

- **Chatflow**：面向对话类情景，包括客户服务、语义搜索、以及其他需要在构建响应时进行多步逻辑的对话式应用程序。
- **Workflow**：面向自动化和批处理情景，适合高质量翻译、数据分析、内容生成、电子邮件自动化等应用程序

# 七、应用

- 预置应用类型
    - 对话型应用：基于 LLM 构建对话式交互的助手
    - 文本生成应用：构建面向文本生成类任务的助手，例如撰写故事、文本分类、翻译等
    - Agent：能够分解任务、推理思考、调用工具的对话式智能助手
    - 工作流：基于流程编排的方式定义更加灵活的 LLM 工作流



# 八、标注

- 标注回复：
    - 基于经人类标注的 Q&A 对，可用于相似度对比回复 
    - 可导出为供模型微调环节使用的数据格式



- 日志标注

















